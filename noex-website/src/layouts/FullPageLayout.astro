---
import '../styles/global.css';
import { type Locale, useTranslations, localeNames, locales, getLocalizedPath } from '../i18n/utils';

interface Props {
  locale: Locale;
  currentPath?: string;
}

const { locale, currentPath = '/' } = Astro.props;
const t = useTranslations(locale);
---

<!DOCTYPE html>
<html lang={locale}>
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={t('meta.description')} />
    <title>{t('meta.title')}</title>

    <!-- Alternate language links for SEO -->
    {locales.map((l) => (
      <link
        rel="alternate"
        hreflang={l}
        href={getLocalizedPath(currentPath, l)}
      />
    ))}

    <!-- Preload fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
  </head>
  <body class="snap-container">
    <!-- Navigation -->
    <nav class="fixed top-0 left-0 right-0 z-50 nav-blur">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
          <!-- Logo -->
          <a href={`/${locale}/`} class="flex items-center space-x-2">
            <span class="text-2xl font-bold text-accent-primary">noex</span>
          </a>

          <!-- Nav Links -->
          <div class="hidden md:flex items-center space-x-8">
            <a href="#features" class="nav-link">{t('nav.features')}</a>
            <a href="#playground" class="nav-link">{t('nav.playground')}</a>
            <a href="https://github.com/your-org/noex" target="_blank" rel="noopener" class="nav-link">
              {t('nav.github')}
            </a>
          </div>

          <!-- Language Switcher -->
          <div class="flex items-center space-x-2">
            {locales.map((l) => (
              <a
                href={getLocalizedPath(currentPath, l)}
                class:list={[
                  'px-2 py-1 text-sm rounded transition-colors',
                  l === locale
                    ? 'bg-accent-primary/20 text-accent-primary'
                    : 'text-text-secondary hover:text-text-primary'
                ]}
              >
                {l.toUpperCase()}
              </a>
            ))}
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content with Scroll Snap -->
    <main>
      <slot />
    </main>

    <!-- Scroll Indicator (dots) -->
    <div class="scroll-indicator">
      <div class="dot active" data-section="0"></div>
      <div class="dot" data-section="1"></div>
      <div class="dot" data-section="2"></div>
      <div class="dot" data-section="3"></div>
      <div class="dot" data-section="4"></div>
      <div class="dot" data-section="5"></div>
      <div class="dot" data-section="6"></div>
      <div class="dot" data-section="7"></div>
    </div>

    <!-- Keyboard navigation script -->
    <script>
      const sections = document.querySelectorAll('.snap-section');
      const dots = document.querySelectorAll('.scroll-indicator .dot');
      const container = document.querySelector('.snap-container');

      // Update active dot on scroll
      if (container) {
        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                const index = Array.from(sections).indexOf(entry.target as Element);
                dots.forEach((dot, i) => {
                  dot.classList.toggle('active', i === index);
                });
              }
            });
          },
          { root: container, threshold: 0.5 }
        );

        sections.forEach((section) => observer.observe(section));
      }

      // Keyboard navigation
      document.addEventListener('keydown', (e) => {
        if (!container) return;

        const currentSection = Array.from(sections).findIndex(
          (section) => section.getBoundingClientRect().top >= -100
        );

        if (e.key === 'ArrowDown' || e.key === 'PageDown') {
          e.preventDefault();
          const nextSection = sections[Math.min(currentSection + 1, sections.length - 1)];
          nextSection?.scrollIntoView({ behavior: 'smooth' });
        }

        if (e.key === 'ArrowUp' || e.key === 'PageUp') {
          e.preventDefault();
          const prevSection = sections[Math.max(currentSection - 1, 0)];
          prevSection?.scrollIntoView({ behavior: 'smooth' });
        }
      });

      // Click on dots to navigate
      dots.forEach((dot, index) => {
        dot.addEventListener('click', () => {
          sections[index]?.scrollIntoView({ behavior: 'smooth' });
        });
      });
    </script>

    <style>
      @reference "../styles/global.css";

      /* Full-page scroll snap */
      .snap-container {
        height: 100vh;
        overflow-y: scroll;
        scroll-snap-type: y mandatory;
        scroll-behavior: smooth;
      }

      /* Navigation blur effect */
      .nav-blur {
        background: rgba(10, 10, 15, 0.8);
        backdrop-filter: blur(12px);
        border-bottom: 1px solid var(--color-border);
      }

      .nav-link {
        color: var(--color-text-secondary);
        transition: color 0.15s ease;
      }

      .nav-link:hover {
        color: var(--color-text-primary);
      }

      /* Scroll indicator dots */
      .scroll-indicator {
        position: fixed;
        right: 2rem;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        z-index: 40;
      }

      .scroll-indicator .dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--color-border);
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .scroll-indicator .dot:hover {
        background: var(--color-text-secondary);
      }

      .scroll-indicator .dot.active {
        background: var(--color-accent-primary);
        box-shadow: 0 0 10px var(--color-accent-primary);
      }

      /* Hide scroll indicator on mobile */
      @media (max-width: 768px) {
        .scroll-indicator {
          display: none;
        }
      }
    </style>
  </body>
</html>
